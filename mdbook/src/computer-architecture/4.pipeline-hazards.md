## Pipeline Hazards

- Hazards: circumstances that would cause incorrect execution if next
  instruction is fetched and executed
- **Structural hazards:** Different instructions, at different stages, in the
  pipeline want to use the same hardware resource
- **Data hazards:** An instruction in the pipeline requires data to be computed by
  a previous instruction still in the pipeline
- **Control hazards:** Succeeding instruction, to put into pipeline, depends on the
  outcome of a previous branch instruction, already in pipeline

## Structural Hazard
- Eliminate the use same hardware for two different things at the same time
- Solution 1: Wait
  - must detect the hazard
  - must have mechanism to stall

- Solution 2: Duplicate hardware
  - Multiple such units will help both instruction to progress
![Eliminating Structural Hazard](./images/eliminating-structural-hazard.png) 

## Data Hazard

### Read After Write(RAW)
- Instr-2 tries to read operand before Instr-1, writes it
  ```
  Instr-1: add r1,r2,r3
  Instr-2: sub r4,r1,r3
  ```

### Write After Read (WAR)
- Instr-2, writes operand before Instr-1, reads it
  ```
  Instr-1: sub r4,r1,r3
  Instr-2: add r1,r2,r3
  Instr-3: mul r6,r1,r7
  ```
- Called an anti-dependence by compiler writers.
- This results from reuse of the name r1
- Can’t happen in MIPS 5 stage pipeline because:
  - All instructions take 5 stages, and
  - Reads are always in stage 2, and
  - Writes are always in stage 5

### Write After Write (WAW)
- Instr-2, writes operand before Instr-1, writes it.
  ```
  Instr-1: sub r1,r4,r3
  Instr-2: add r1,r2,r3
  Instr-3: mul r6,r1,r7
  ```
- Called an output dependence
- This also results from the reuse of name r1
- Can’t happen in MIPS 5 stage pipeline because:
  - All instructions take 5 stages, and
  - Writes are always in stage 5
- WAR and WAW happens in out of order pipes



